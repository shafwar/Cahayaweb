import{j as e,A as b,m as w}from"./app-CERduI2n.js";import{d as R,r,b as T,a as A}from"./inertia-DFKzB8kt.js";import{u as M}from"./GlobalHeader-CfJRKVAV.js";function z(s){const o=window.getSelection();if(!o||o.rangeCount===0)return null;const i=o.getRangeAt(0),n=i.cloneRange();n.selectNodeContents(s),n.setEnd(i.endContainer,i.endOffset);const a=n.toString().length,c=a+i.toString().length;return{start:a,end:c}}function D(s,o){if(!o)return;const i=window.getSelection();if(i)try{const n=s.childNodes[0]||s,a=document.createRange(),c=Math.min(o.start,(n.textContent||"").length),g=Math.min(o.end,(n.textContent||"").length);n.nodeType===Node.TEXT_NODE?(a.setStart(n,c),a.setEnd(n,g)):(a.selectNodeContents(s),a.collapse(!1)),i.removeAllRanges(),i.addRange(a)}catch(n){console.debug("Could not restore cursor position:",n)}}function W({sectionKey:s,value:o,tag:i="div",className:n}){const{isAdmin:a,editMode:c,markDirty:g,clearDirty:L}=M(),{props:E}=R(),h=E.sections?.[s]?.content,y=h??o??"",[d,j]=r.useState(y),[C,N]=r.useState(!1),[u,S]=r.useState(!1),[l,p]=r.useState(!1),f=r.useRef(null),v=r.useRef(null);r.useEffect(()=>{const t=h??o??"";t!==d&&!l&&j(t)},[h,o]),r.useEffect(()=>{f.current&&v.current&&document.activeElement===f.current&&D(f.current,v.current)},[d]);const m=r.useCallback(async t=>{if(l){S(!0);try{await T.post("/admin/update-section",{key:s,content:t}),N(!0),p(!1),setTimeout(()=>N(!1),2e3),A.reload({only:["sections"]})}catch(x){console.error("Failed to save text:",x)}finally{S(!1)}}},[s,l]),k=r.useCallback(()=>{l&&!u&&(console.log("ðŸ’¾ Saving on blur for:",s),m(d))},[l,u,d,m,s]);return r.useEffect(()=>{const t=()=>{l&&!u&&(console.log("ðŸ’¾ Global save triggered for:",s),m(d))};return window.addEventListener("cms:flush-save",t),()=>window.removeEventListener("cms:flush-save",t)},[l,u,d,m,s]),e.jsxs("div",{className:c&&a?"group relative":void 0,children:[e.jsx(i,{ref:f,contentEditable:a&&c,suppressContentEditableWarning:!0,onInput:t=>{f.current&&(v.current=z(f.current));const x=t.currentTarget.innerText;j(x),x!==y?(p(!0),g()):p(!1)},onBlur:k,onKeyDown:t=>{(t.ctrlKey||t.metaKey)&&t.key==="s"&&(t.preventDefault(),l&&m(d))},className:`${n??""} ${a&&c?`rounded-sm ring-2 outline-none transition-all ${l?"ring-amber-500/80 hover:ring-amber-500 shadow-lg shadow-amber-500/20":"ring-blue-400/40 hover:ring-blue-400/60"}`:""}`,children:d}),a&&c&&e.jsxs(e.Fragment,{children:[e.jsx(b,{children:l&&!u&&!C&&e.jsx(w.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"absolute -bottom-7 left-0 z-50 rounded-md bg-amber-500 px-2.5 py-1 text-xs text-white font-semibold shadow-lg",children:e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsxs("span",{className:"flex h-1.5 w-1.5",children:[e.jsx("span",{className:"absolute inline-flex h-1.5 w-1.5 animate-ping rounded-full bg-white opacity-75"}),e.jsx("span",{className:"relative inline-flex h-1.5 w-1.5 rounded-full bg-white"})]}),'Unsaved - Click "Save" or click away']})})}),e.jsx(b,{children:u&&e.jsx(w.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"absolute -bottom-7 left-0 z-50 rounded-md bg-blue-500 px-2.5 py-1 text-xs text-white font-semibold shadow-lg",children:e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsxs("svg",{className:"h-3 w-3 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]})})}),e.jsx(b,{children:C&&e.jsx(w.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:8},className:"absolute -bottom-7 left-0 z-50 rounded-md bg-emerald-500 px-2.5 py-1 text-xs text-white font-semibold shadow-lg",children:e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}),"Saved!"]})})})]})]})}export{W as E};
