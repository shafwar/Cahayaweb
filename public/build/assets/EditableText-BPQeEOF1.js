import{j as e,A as y,m as w}from"./app-Je0bcF0e.js";import{d as R,r as o,a as T,b as M}from"./inertia-B5_hUOTa.js";import{u as A}from"./GlobalHeader-CpZSih08.js";function D(n){const r=window.getSelection();if(!r||r.rangeCount===0)return null;const i=r.getRangeAt(0),s=i.cloneRange();s.selectNodeContents(n),s.setEnd(i.endContainer,i.endOffset);const a=s.toString().length,c=a+i.toString().length;return{start:a,end:c}}function L(n,r){if(!r)return;const i=window.getSelection();if(i)try{const s=n.childNodes[0]||n,a=document.createRange(),c=Math.min(r.start,(s.textContent||"").length),g=Math.min(r.end,(s.textContent||"").length);s.nodeType===Node.TEXT_NODE?(a.setStart(s,c),a.setEnd(s,g)):(a.selectNodeContents(n),a.collapse(!1)),i.removeAllRanges(),i.addRange(a)}catch(s){console.debug("Could not restore cursor position:",s)}}function $({sectionKey:n,value:r,tag:i="div",className:s}){const{isAdmin:a,editMode:c,markDirty:g,clearDirty:P}=A(),{props:S}=R(),p=S.sections?.[n]?.content,b=p??r??"",[d,j]=o.useState(b),[N,C]=o.useState(!1),[u,E]=o.useState(!1),[l,h]=o.useState(!1),m=o.useRef(null),v=o.useRef(null);o.useEffect(()=>{const t=p??r??"";t!==d&&!l&&j(t)},[p,r]),o.useEffect(()=>{m.current&&v.current&&document.activeElement===m.current&&L(m.current,v.current)},[d]);const x=o.useCallback(async t=>{if(l){E(!0);try{await T.post("/admin/update-section",{key:n,content:t}),C(!0),h(!1),setTimeout(()=>C(!1),2e3),M.reload({only:["sections"]})}catch(f){console.error("Failed to save text:",f)}finally{E(!1)}}},[n,l]),k=o.useCallback(()=>{l&&!u&&(console.log("ðŸ’¾ Saving on blur for:",n),x(d))},[l,u,d,x,n]);return o.useEffect(()=>{const t=()=>{l&&!u&&(console.log("ðŸ’¾ Global save triggered for:",n),x(d))};return window.addEventListener("cms:flush-save",t),()=>window.removeEventListener("cms:flush-save",t)},[l,u,d,x,n]),e.jsx("div",{className:c&&a?"group relative":void 0,children:e.jsxs("div",{className:"relative",children:[e.jsx(i,{ref:m,contentEditable:a&&c,suppressContentEditableWarning:!0,onInput:t=>{m.current&&(v.current=D(m.current));const f=t.currentTarget.innerText;j(f),f!==b?(h(!0),g()):h(!1)},onBlur:k,onKeyDown:t=>{(t.ctrlKey||t.metaKey)&&t.key==="s"&&(t.preventDefault(),l&&x(d))},className:`${s??""} ${a&&c?`rounded-sm ring-2 outline-none transition-all ${l?"ring-amber-500/80 hover:ring-amber-500 shadow-lg shadow-amber-500/20":"ring-blue-400/40 hover:ring-blue-400/60"}`:""}`,children:d}),a&&c&&e.jsxs("div",{className:"pointer-events-none absolute -top-8 left-0 flex flex-col gap-1",children:[e.jsx(y,{children:l&&!u&&!N&&e.jsx(w.div,{initial:{opacity:0,y:4},animate:{opacity:1,y:0},exit:{opacity:0,y:4},className:"w-max rounded-md bg-amber-500 px-2.5 py-1 text-xs font-semibold text-white shadow-lg ring-1 ring-amber-300/50",children:e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsxs("span",{className:"flex h-1.5 w-1.5",children:[e.jsx("span",{className:"absolute inline-flex h-1.5 w-1.5 animate-ping rounded-full bg-white opacity-75"}),e.jsx("span",{className:"relative inline-flex h-1.5 w-1.5 rounded-full bg-white"})]}),"Unsaved â€” click Save atau klik di luar"]})})}),e.jsx(y,{children:u&&e.jsx(w.div,{initial:{opacity:0,y:4},animate:{opacity:1,y:0},exit:{opacity:0,y:4},className:"w-max rounded-md bg-blue-500 px-2.5 py-1 text-xs font-semibold text-white shadow-lg ring-1 ring-blue-300/50",children:e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsxs("svg",{className:"h-3 w-3 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Menyimpan..."]})})}),e.jsx(y,{children:N&&e.jsx(w.div,{initial:{opacity:0,y:4},animate:{opacity:1,y:0},exit:{opacity:0,y:4},className:"w-max rounded-md bg-emerald-500 px-2.5 py-1 text-xs font-semibold text-white shadow-lg ring-1 ring-emerald-300/50",children:e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}),"Tersimpan âœ“"]})})})]})]})})}export{$ as E};
