import{j as e}from"./framer-motion-B-VyjaWK.js";import{r as l,u as X,H as K}from"./inertia-DnB9r-Z9.js";import{L as E,I as P}from"./label-C1LSqyaF.js";import{T}from"./text-link-Cucovmez.js";import{B as G}from"./button-UGvbK2Hg.js";import{c as J,P as V,a as R,u as $,b as A,d as F,e as Q,f as W}from"./radix-ui-BGF_4iPy.js";import{c as Y}from"./utils-CBfrqCZ4.js";import{s as Z,t as ee,E as oe,r as te}from"./lucide-BFbptF3M.js";import{I as _}from"./input-DC9bAHPH.js";import{A as re}from"./auth-layout-CLqlwe4C.js";import"./vendor-DP3lGzMr.js";import"./imageHelper-DKYo5vcR.js";var S="Checkbox",[se,Ce]=J(S),[ne,L]=se(S);function ae(t){const{__scopeCheckbox:d,checked:s,children:x,defaultChecked:c,disabled:o,form:b,name:k,onCheckedChange:m,required:i,value:g="on",internal_do_not_use_render:f}=t,[p,u]=$({prop:s,defaultProp:c??!1,onChange:m,caller:S}),[w,C]=l.useState(null),[h,r]=l.useState(null),n=l.useRef(!1),a=w?!!b||!!w.closest("form"):!0,j={checked:p,disabled:o,setChecked:u,control:w,setControl:C,name:k,form:b,value:g,hasConsumerStoppedPropagationRef:n,required:i,defaultChecked:v(c)?!1:c,isFormControl:a,bubbleInput:h,setBubbleInput:r};return e.jsx(ne,{scope:d,...j,children:ie(f)?f(j):x})}var B="CheckboxTrigger",q=l.forwardRef(({__scopeCheckbox:t,onKeyDown:d,onClick:s,...x},c)=>{const{control:o,value:b,disabled:k,checked:m,required:i,setControl:g,setChecked:f,hasConsumerStoppedPropagationRef:p,isFormControl:u,bubbleInput:w}=L(B,t),C=A(c,g),h=l.useRef(m);return l.useEffect(()=>{const r=o?.form;if(r){const n=()=>f(h.current);return r.addEventListener("reset",n),()=>r.removeEventListener("reset",n)}},[o,f]),e.jsx(R.button,{type:"button",role:"checkbox","aria-checked":v(m)?"mixed":m,"aria-required":i,"data-state":U(m),"data-disabled":k?"":void 0,disabled:k,value:b,...x,ref:C,onKeyDown:F(d,r=>{r.key==="Enter"&&r.preventDefault()}),onClick:F(s,r=>{f(n=>v(n)?!0:!n),w&&u&&(p.current=r.isPropagationStopped(),p.current||r.stopPropagation())})})});q.displayName=B;var D=l.forwardRef((t,d)=>{const{__scopeCheckbox:s,name:x,checked:c,defaultChecked:o,required:b,disabled:k,value:m,onCheckedChange:i,form:g,...f}=t;return e.jsx(ae,{__scopeCheckbox:s,checked:c,defaultChecked:o,disabled:k,required:b,onCheckedChange:i,name:x,form:g,value:m,internal_do_not_use_render:({isFormControl:p})=>e.jsxs(e.Fragment,{children:[e.jsx(q,{...f,ref:d,__scopeCheckbox:s}),p&&e.jsx(z,{__scopeCheckbox:s})]})})});D.displayName=S;var M="CheckboxIndicator",H=l.forwardRef((t,d)=>{const{__scopeCheckbox:s,forceMount:x,...c}=t,o=L(M,s);return e.jsx(V,{present:x||v(o.checked)||o.checked===!0,children:e.jsx(R.span,{"data-state":U(o.checked),"data-disabled":o.disabled?"":void 0,...c,ref:d,style:{pointerEvents:"none",...t.style}})})});H.displayName=M;var O="CheckboxBubbleInput",z=l.forwardRef(({__scopeCheckbox:t,...d},s)=>{const{control:x,hasConsumerStoppedPropagationRef:c,checked:o,defaultChecked:b,required:k,disabled:m,name:i,value:g,form:f,bubbleInput:p,setBubbleInput:u}=L(O,t),w=A(s,u),C=Q(o),h=W(x);l.useEffect(()=>{const n=p;if(!n)return;const a=window.HTMLInputElement.prototype,y=Object.getOwnPropertyDescriptor(a,"checked").set,I=!c.current;if(C!==o&&y){const N=new Event("click",{bubbles:I});n.indeterminate=v(o),y.call(n,v(o)?!1:o),n.dispatchEvent(N)}},[p,C,o,c]);const r=l.useRef(v(o)?!1:o);return e.jsx(R.input,{type:"checkbox","aria-hidden":!0,defaultChecked:b??r.current,required:k,disabled:m,name:i,value:g,form:f,...d,tabIndex:-1,ref:w,style:{...d.style,...h,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});z.displayName=O;function ie(t){return typeof t=="function"}function v(t){return t==="indeterminate"}function U(t){return v(t)?"indeterminate":t?"checked":"unchecked"}function ce({className:t,...d}){return e.jsx(D,{"data-slot":"checkbox",className:Y("peer border-input data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...d,children:e.jsx(H,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(Z,{className:"size-3.5"})})})}function ve({status:t,canResetPassword:d,mode:s,redirect:x,error:c}){const[o,b]=l.useState(!1),[k,m]=l.useState(!1),{data:i,setData:g,post:f,processing:p,errors:u,reset:w}=X({email:"",password:"",remember:!1,mode:typeof s=="string"?s:void 0,redirect:x??void 0});l.useEffect(()=>{(async()=>{try{console.log("[Login] Refreshing CSRF token on page load..."),(await fetch("/sanctum/csrf-cookie",{method:"HEAD",credentials:"include",cache:"no-store",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}})).ok?setTimeout(()=>{const n=document.querySelector('meta[name="csrf-token"]');if(n){const a=n.content;console.log("[Login] CSRF token refreshed:",a?"Token available":"Token missing"),a&&typeof window<"u"&&window.axios&&(window.axios.defaults.headers.common["X-CSRF-TOKEN"]=a),m(!0)}else console.warn("[Login] CSRF meta tag not found after refresh"),window.location.reload()},100):(console.warn("[Login] Failed to refresh CSRF token, reloading page..."),window.location.reload())}catch(r){console.error("[Login] Error refreshing CSRF token:",r),window.location.reload()}})()},[]);const C=h=>{h.preventDefault();const r=document.querySelector('meta[name="csrf-token"]')?.content;if(!r){console.error("CSRF token not found in meta tag - reloading page"),window.location.reload();return}r&&typeof window<"u"&&window.axios&&(window.axios.defaults.headers.common["X-CSRF-TOKEN"]=r);const n="/login";console.log("[Login] Using relative URL (browser will resolve to HTTPS):",n),console.log("[Login] Current page protocol:",window.location.protocol),console.log("[Login] Current page origin:",window.location.origin),f(n,{preserveState:!1,preserveScroll:!1,onFinish:()=>w("password"),onSuccess:a=>{console.log("[Login] Success - redirecting...",{url:a.url,component:a.component})},onError:a=>{console.error("[Login] Error occurred:",a);const j=a?.message||(typeof a=="string"?a:"")||"",y=JSON.stringify(a||{});if(j.includes("419")||j.includes("expired")||j.includes("PAGE EXPIRED")||y.includes("419")||y.includes("expired")||y.includes("csrf")||y.includes("token")){console.warn("[Login] CSRF token expired, reloading page to refresh..."),setTimeout(()=>{window.location.reload()},500);return}if(a.email||a.password){console.log("[Login] Validation errors - refreshing CSRF token for next attempt..."),fetch("/sanctum/csrf-cookie",{method:"HEAD",credentials:"include",cache:"no-store"}).then(()=>{setTimeout(()=>{const N=document.querySelector('meta[name="csrf-token"]');N&&N.content&&(typeof window<"u"&&window.axios&&(window.axios.defaults.headers.common["X-CSRF-TOKEN"]=N.content),console.log("[Login] CSRF token refreshed after validation error"))},100)}).catch(N=>{console.error("[Login] Failed to refresh CSRF token after validation error:",N),setTimeout(()=>{window.location.reload()},1e3)});return}console.warn("[Login] Unknown error - refreshing CSRF token as precaution..."),fetch("/sanctum/csrf-cookie",{method:"HEAD",credentials:"include",cache:"no-store"}).catch(()=>{setTimeout(()=>{window.location.reload()},1e3)})}})};return e.jsxs(re,{title:s==="admin"?"Admin Login":"Log in to your account",description:s==="admin"?"Enter your admin credentials to access the admin dashboard":"Enter your email and password below to log in",children:[e.jsx(K,{title:s==="admin"?"Admin Login":"Log in"}),c&&e.jsx("div",{className:"mb-4 rounded-lg border border-red-500/30 bg-red-500/10 p-3",children:e.jsx("p",{className:"text-sm text-red-300",children:c})}),e.jsxs("form",{method:"POST",className:"flex flex-col gap-6",onSubmit:C,children:[i.mode&&e.jsx("input",{type:"hidden",name:"mode",value:i.mode}),i.redirect&&e.jsx("input",{type:"hidden",name:"redirect",value:i.redirect}),e.jsxs("div",{className:"grid gap-6",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{htmlFor:"email",children:"Email address"}),e.jsx(_,{id:"email",type:"email",required:!0,autoFocus:!0,tabIndex:1,autoComplete:"email",value:i.email,onChange:h=>g("email",h.target.value),placeholder:"email@example.com"}),e.jsx(P,{message:u.email}),u.email&&e.jsx("div",{className:"mt-2 rounded-lg border border-red-500/30 bg-red-500/10 p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("svg",{className:"mt-0.5 h-4 w-4 flex-shrink-0 text-red-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-red-300",children:u.email}),u.email.includes("Admin accounts cannot login")&&e.jsxs("p",{className:"mt-1 text-xs text-red-200",children:["Please use the admin login page directly at ",e.jsx("code",{className:"text-xs bg-red-500/20 px-1 py-0.5 rounded",children:"/admin"})]})]})]})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(E,{htmlFor:"password",children:"Password"}),d&&e.jsx(T,{href:route("password.request"),className:"ml-auto text-sm",tabIndex:5,children:"Forgot password?"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(_,{id:"password",type:o?"text":"password",required:!0,tabIndex:2,autoComplete:"current-password",value:i.password,onChange:h=>g("password",h.target.value),placeholder:"Password",className:"pr-10"}),e.jsx("button",{type:"button",onClick:()=>b(!o),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 focus:outline-none focus:text-gray-600 transition-colors",tabIndex:-1,"aria-label":o?"Hide password":"Show password",children:o?e.jsx(ee,{className:"h-4 w-4"}):e.jsx(oe,{className:"h-4 w-4"})})]}),e.jsx(P,{message:u.password}),u.password&&e.jsx("div",{className:"mt-2 rounded-lg border border-red-500/30 bg-red-500/10 p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("svg",{className:"mt-0.5 h-4 w-4 flex-shrink-0 text-red-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),e.jsx("p",{className:"text-sm font-medium text-red-300",children:u.password})]})})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ce,{id:"remember",name:"remember",checked:i.remember,onClick:()=>g("remember",!i.remember),tabIndex:3}),e.jsx(E,{htmlFor:"remember",children:"Remember me"})]}),e.jsxs(G,{type:"submit",className:"mt-4 w-full",tabIndex:4,disabled:p,children:[p&&e.jsx(te,{className:"h-4 w-4 animate-spin"}),"Log in"]})]}),s!=="admin"&&e.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:["Don't have an account?"," ",e.jsx(T,{href:route("register"),tabIndex:5,children:"Sign up"})]})]}),t&&e.jsx("div",{className:"mb-4 text-center text-sm font-medium text-green-600",children:t})]})}export{ve as default};
