import{j as e,b as v,m as y}from"./app-B4U0WYun.js";import{d as T,r as i,b as M,a as A}from"./inertia-DFKzB8kt.js";import{u as L}from"./GlobalHeader-ClXRoPkq.js";function P(n){const r=window.getSelection();if(!r||r.rangeCount===0)return null;const l=r.getRangeAt(0),s=l.cloneRange();s.selectNodeContents(n),s.setEnd(l.endContainer,l.endOffset);const a=s.toString().length,d=a+l.toString().length;return{start:a,end:d}}function B(n,r){if(!r)return;const l=window.getSelection();if(l)try{const s=n.childNodes[0]||n,a=document.createRange(),d=Math.min(r.start,(s.textContent||"").length),f=Math.min(r.end,(s.textContent||"").length);s.nodeType===Node.TEXT_NODE?(a.setStart(s,d),a.setEnd(s,f)):(a.selectNodeContents(n),a.collapse(!1)),l.removeAllRanges(),l.addRange(a)}catch(s){console.debug("Could not restore cursor position:",s)}}function $({sectionKey:n,value:r,tag:l="div",className:s}){const{isAdmin:a,editMode:d,markDirty:f}=L(),{props:k}=T(),g=k.sections?.[n]?.content,b=g??r??"",[c,w]=i.useState(b),[j,N]=i.useState(!1),[u,C]=i.useState(!1),[o,p]=i.useState(!1),m=i.useRef(null),h=i.useRef(null);i.useEffect(()=>{const t=g??r??"";t!==c&&!o&&w(t)},[g,r,c,o]),i.useEffect(()=>{m.current&&h.current&&document.activeElement===m.current&&B(m.current,h.current)},[c]);const x=i.useCallback(async t=>{if(o){C(!0);try{await M.post("/admin/update-section",{key:n,content:t}),N(!0),p(!1),setTimeout(()=>N(!1),2e3),A.reload({only:["sections"]})}catch(E){console.error("Failed to save text:",E)}finally{C(!1)}}},[n,o]),R=i.useCallback(()=>{o&&!u&&(console.log("ðŸ’¾ Saving on blur for:",n),x(c))},[o,u,c,x,n]);return i.useEffect(()=>{const t=()=>{o&&!u&&(console.log("ðŸ’¾ Global save triggered for:",n),x(c))};return window.addEventListener("cms:flush-save",t),()=>window.removeEventListener("cms:flush-save",t)},[o,u,c,x,n]),e.jsx("div",{className:d&&a?"group relative":void 0,children:e.jsxs("div",{className:"relative",children:[e.jsx(l,{ref:m,contentEditable:a&&d,suppressContentEditableWarning:!0,onInput:t=>{m.current&&(h.current=P(m.current));const S=t.currentTarget.innerText;w(S),S!==b?(p(!0),f()):p(!1)},onBlur:R,onKeyDown:t=>{(t.ctrlKey||t.metaKey)&&t.key==="s"&&(t.preventDefault(),o&&x(c))},className:`${s??""} ${a&&d?`rounded-sm ring-2 outline-none transition-all ${o?"ring-amber-500/80 hover:ring-amber-500 shadow-lg shadow-amber-500/20":"ring-blue-400/40 hover:ring-blue-400/60"}`:""}`,children:c}),a&&d&&e.jsxs("div",{className:"pointer-events-none absolute -top-8 left-0 flex flex-col gap-1",children:[e.jsx(v,{children:o&&!u&&!j&&e.jsx(y.div,{initial:{opacity:0,y:4},animate:{opacity:1,y:0},exit:{opacity:0,y:4},className:"w-max rounded-md bg-amber-500 px-2.5 py-1 text-xs font-semibold text-white shadow-lg ring-1 ring-amber-300/50",children:e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsxs("span",{className:"flex h-1.5 w-1.5",children:[e.jsx("span",{className:"absolute inline-flex h-1.5 w-1.5 animate-ping rounded-full bg-white opacity-75"}),e.jsx("span",{className:"relative inline-flex h-1.5 w-1.5 rounded-full bg-white"})]}),"Unsaved â€” click Save atau klik di luar"]})})}),e.jsx(v,{children:u&&e.jsx(y.div,{initial:{opacity:0,y:4},animate:{opacity:1,y:0},exit:{opacity:0,y:4},className:"w-max rounded-md bg-blue-500 px-2.5 py-1 text-xs font-semibold text-white shadow-lg ring-1 ring-blue-300/50",children:e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsxs("svg",{className:"h-3 w-3 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Menyimpan..."]})})}),e.jsx(v,{children:j&&e.jsx(y.div,{initial:{opacity:0,y:4},animate:{opacity:1,y:0},exit:{opacity:0,y:4},className:"w-max rounded-md bg-emerald-500 px-2.5 py-1 text-xs font-semibold text-white shadow-lg ring-1 ring-emerald-300/50",children:e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}),"Tersimpan âœ“"]})})})]})]})})}export{$ as E};
