import{j as e,A as M,m as C}from"./framer-motion-D9Ds6MjR.js";import{r as c,H as L,b as _}from"./inertia-D2QVZ4Tm.js";import{P as I,g as z}from"./app-DFHYiAgk.js";import{n as B,v as b,k as D,w as O,x as S,y as R,z as Q,C as V,G as q,U as G,R as T}from"./lucide-CmpPQWiQ.js";import"./vendor-DP3lGzMr.js";/* empty css            */import"./radix-ui-CoelwvIk.js";function te({sections:h}){const[o,H]=c.useState(""),[l,p]=c.useState("all"),[A,$]=c.useState(new Set),[f,u]=c.useState(null),y=t=>{const a=t.split("."),s=a[0]||"Unknown",d=a[1]||"",x=a[2]||"",m=a[3]||a[2]||"";return{page:s.charAt(0).toUpperCase()+s.slice(1),section:d.replace(/([A-Z])/g," $1").trim(),id:x,field:m.charAt(0).toUpperCase()+m.slice(1),fullPath:t}},j=c.useMemo(()=>h.filter(t=>{if(o){const a=o.toLowerCase(),{page:s,section:d,field:x}=y(t.key);if(!`${s} ${d} ${x} ${t.key}`.toLowerCase().includes(a))return!1}return!(l!=="all"&&(!(t.revisions.length>0)||l==="text"&&!t.current_content||l==="image"&&!t.current_image))}),[h,o,l]),N=c.useMemo(()=>{const t={};return j.forEach(a=>{const{page:s}=y(a.key);t[s]||(t[s]=[]),t[s].push(a)}),t},[j]),U=t=>{$(a=>{const s=new Set(a);return s.has(t)?s.delete(t):s.add(t),s})},E=async(t,a)=>{if(confirm(`Are you sure you want to restore to this version?

This will replace the current content with the selected revision.`)){u(a);try{await _.post("/admin/history/restore",{key:t,revision_id:a},{preserveState:!1,onSuccess:()=>{const s=document.createElement("div");s.className="fixed top-20 right-4 z-[99999] rounded-lg bg-gradient-to-r from-green-500 to-emerald-500 px-6 py-4 text-white shadow-2xl",s.innerHTML=`
                        <div class="flex items-center gap-3">
                            <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                            <div>
                                <div class="font-bold">âœ… Restored Successfully!</div>
                                <div class="text-sm opacity-90">Reloading page...</div>
                            </div>
                        </div>
                    `,document.body.appendChild(s),setTimeout(()=>{window.location.href=window.location.href.split("?")[0]+"?t="+Date.now()},800)},onError:s=>{console.error("Restore failed:",s),alert("Failed to restore: "+(s.message||"Unknown error")),u(null)}})}catch(s){console.error("Restore error:",s),alert("Failed to restore revision"),u(null)}}},P=t=>{switch(t){case"text_update":return"bg-blue-500/20 text-blue-400 border-blue-500/30";case"image_upload":return"bg-purple-500/20 text-purple-400 border-purple-500/30";case"restore":return"bg-green-500/20 text-green-400 border-green-500/30";default:return"bg-gray-500/20 text-gray-400 border-gray-500/30"}},v=t=>{switch(t){case"text_update":return e.jsx(S,{className:"h-3 w-3"});case"image_upload":return e.jsx(R,{className:"h-3 w-3"});case"restore":return e.jsx(T,{className:"h-3 w-3"});default:return e.jsx(b,{className:"h-3 w-3"})}};return e.jsxs(I,{children:[e.jsx(L,{title:"Admin History Management"}),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-black py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"mx-auto max-w-7xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>_.visit("/home"),className:"mb-4 flex items-center gap-2 text-gray-400 transition-colors hover:text-white",children:[e.jsx(B,{className:"h-4 w-4"}),"Back to Home"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"flex items-center gap-3 text-4xl font-bold text-white",children:[e.jsx(b,{className:"h-8 w-8 text-blue-400"}),"History Management"]}),e.jsx("p",{className:"mt-2 text-gray-400",children:"View and restore all content changes across your website"})]}),e.jsxs("div",{className:"rounded-lg bg-blue-500/10 px-4 py-2 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-400",children:h.length}),e.jsx("div",{className:"text-xs text-gray-400",children:"Total Sections"})]})]})]}),e.jsxs("div",{className:"mb-6 flex flex-col gap-4 sm:flex-row",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(D,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by page, section, or field...",value:o,onChange:t=>H(t.target.value),className:"w-full rounded-lg border border-gray-700 bg-gray-800/50 py-3 pl-10 pr-4 text-white placeholder-gray-500 backdrop-blur-sm transition-all focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>p("all"),className:`flex items-center gap-2 rounded-lg px-4 py-3 transition-all ${l==="all"?"bg-blue-500 text-white":"bg-gray-800/50 text-gray-400 hover:bg-gray-700/50"}`,children:[e.jsx(O,{className:"h-4 w-4"}),"All"]}),e.jsxs("button",{onClick:()=>p("text"),className:`flex items-center gap-2 rounded-lg px-4 py-3 transition-all ${l==="text"?"bg-blue-500 text-white":"bg-gray-800/50 text-gray-400 hover:bg-gray-700/50"}`,children:[e.jsx(S,{className:"h-4 w-4"}),"Text"]}),e.jsxs("button",{onClick:()=>p("image"),className:`flex items-center gap-2 rounded-lg px-4 py-3 transition-all ${l==="image"?"bg-blue-500 text-white":"bg-gray-800/50 text-gray-400 hover:bg-gray-700/50"}`,children:[e.jsx(R,{className:"h-4 w-4"}),"Images"]})]})]}),e.jsxs("div",{className:"space-y-6",children:[Object.entries(N).map(([t,a])=>e.jsxs("div",{className:"rounded-xl border border-gray-700/50 bg-gray-800/30 p-6 backdrop-blur-sm",children:[e.jsxs("h2",{className:"mb-4 text-2xl font-bold text-white",children:[t," Page",e.jsxs("span",{className:"ml-3 text-sm font-normal text-gray-400",children:["(",a.length," sections)"]})]}),e.jsx("div",{className:"space-y-3",children:a.map(s=>{const{section:d,field:x,fullPath:m}=y(s.key),w=A.has(s.key);return e.jsxs("div",{className:"rounded-lg border border-gray-700/50 bg-gray-900/50 transition-all hover:border-gray-600",children:[e.jsxs("button",{onClick:()=>U(s.key),className:"flex w-full items-center justify-between p-4 text-left transition-colors hover:bg-gray-800/30",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"font-semibold text-white",children:[d," - ",x]}),s.current_image&&e.jsx("span",{className:"rounded-full bg-purple-500/20 px-2 py-0.5 text-xs text-purple-400",children:"Has Image"}),s.current_content&&e.jsx("span",{className:"rounded-full bg-blue-500/20 px-2 py-0.5 text-xs text-blue-400",children:"Has Text"})]}),e.jsx("div",{className:"mt-1 text-xs text-gray-500",children:m}),s.revisions.length>0&&e.jsxs("div",{className:"mt-2 text-sm text-gray-400",children:[s.total_revisions," revision",s.total_revisions!==1?"s":""," available"]})]}),w?e.jsx(Q,{className:"h-5 w-5 text-gray-400"}):e.jsx(V,{className:"h-5 w-5 text-gray-400"})]}),e.jsx(M,{children:w&&e.jsx(C.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden border-t border-gray-700/50",children:e.jsx("div",{className:"space-y-3 p-4",children:s.revisions.length===0?e.jsx("div",{className:"py-8 text-center text-gray-500",children:"No revision history available"}):s.revisions.map((r,k)=>e.jsxs(C.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:k*.05},className:"flex items-start gap-4 rounded-lg border border-gray-700/30 bg-gray-800/30 p-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-blue-500/20",children:v(r.change_type)}),k<s.revisions.length-1&&e.jsx("div",{className:"h-full w-px bg-gray-700/50"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"mb-2 flex items-start justify-between gap-4",children:[e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-xs font-medium ${P(r.change_type)}`,children:[v(r.change_type),r.change_type.replace("_"," ")]}),e.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(q,{className:"h-3 w-3"}),r.created_at_human]}),e.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(G,{className:"h-3 w-3"}),r.changed_by]})]})}),e.jsx("button",{onClick:()=>E(s.key,r.id),disabled:f===r.id,className:"flex items-center gap-2 rounded-lg bg-green-500/20 px-3 py-1.5 text-sm font-medium text-green-400 transition-all hover:bg-green-500/30 disabled:opacity-50",children:f===r.id?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"h-4 w-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Restoring..."]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-4 w-4"}),"Restore"]})})]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[r.image&&e.jsx("div",{className:"overflow-hidden rounded-lg border border-gray-700/50",children:e.jsx("img",{src:z(r.image),alt:"Revision preview",className:"h-32 w-full object-cover",onError:F=>{const g=F.currentTarget;if(g.src&&g.src.includes("assets.cahayaanbiya.com")){const n=g.src;let i=n;n.includes("/public/images/")?i=n.replace("/public/images/","/images/"):n.includes("/public/")?i=n.replace("/public/","/"):n.includes("/images/")?i=n.replace("/images/","/public/images/"):i=`https://assets.cahayaanbiya.com/public/images/${n.split("/").pop()||r.image}`,console.log("[History Image] Trying alternative R2 path:",i),g.src=i}}})}),r.content&&e.jsx("div",{className:"rounded-lg border border-gray-700/50 bg-gray-900/50 p-3 text-sm text-gray-300",children:r.content})]})]})]},r.id))})})})]},s.key)})})]},t)),Object.keys(N).length===0&&e.jsxs("div",{className:"rounded-xl border border-gray-700/50 bg-gray-800/30 p-12 text-center backdrop-blur-sm",children:[e.jsx(b,{className:"mx-auto h-16 w-16 text-gray-600"}),e.jsx("h3",{className:"mt-4 text-xl font-semibold text-white",children:"No History Found"}),e.jsx("p",{className:"mt-2 text-gray-400",children:o||l!=="all"?"Try adjusting your filters":"No content changes have been made yet"})]})]})]})})]})}export{te as default};
