import{j as e}from"./framer-motion-D9Ds6MjR.js";import{r as l,d as W,b as O,H as Y}from"./inertia-D2QVZ4Tm.js";import{L as _,I as q}from"./label-CakxCyDK.js";import{T as D}from"./text-link-BPrM55u4.js";import{f as Z,B as ee}from"./app-DBKdMNqx.js";import{d as te,e as se,f as P,u as re,g as z,h as A,i as oe,j as ne}from"./radix-ui-D0Dk_8AA.js";import{N as ae,K as B,O as ie,E as de}from"./lucide-BqQJBEkW.js";import{I as M}from"./input-BHNHUAGL.js";import{A as ce}from"./auth-layout-b3OLG4cI.js";import"./vendor-DP3lGzMr.js";/* empty css            */var I="Checkbox",[le,Ee]=te(I),[me,F]=le(I);function ue(o){const{__scopeCheckbox:p,checked:m,children:v,defaultChecked:u,disabled:t,form:k,name:C,onCheckedChange:b,required:n,value:a="on",internal_do_not_use_render:h}=o,[c,d]=re({prop:m,defaultProp:u??!1,onChange:b,caller:I}),[w,j]=l.useState(null),[i,s]=l.useState(null),f=l.useRef(!1),N=w?!!k||!!w.closest("form"):!0,S={checked:c,disabled:t,setChecked:d,control:w,setControl:j,name:C,form:k,value:a,hasConsumerStoppedPropagationRef:f,required:n,defaultChecked:y(u)?!1:u,isFormControl:N,bubbleInput:i,setBubbleInput:s};return e.jsx(me,{scope:p,...S,children:fe(h)?h(S):v})}var H="CheckboxTrigger",K=l.forwardRef(({__scopeCheckbox:o,onKeyDown:p,onClick:m,...v},u)=>{const{control:t,value:k,disabled:C,checked:b,required:n,setControl:a,setChecked:h,hasConsumerStoppedPropagationRef:c,isFormControl:d,bubbleInput:w}=F(H,o),j=z(u,a),i=l.useRef(b);return l.useEffect(()=>{const s=t?.form;if(s){const f=()=>h(i.current);return s.addEventListener("reset",f),()=>s.removeEventListener("reset",f)}},[t,h]),e.jsx(P.button,{type:"button",role:"checkbox","aria-checked":y(b)?"mixed":b,"aria-required":n,"data-state":V(b),"data-disabled":C?"":void 0,disabled:C,value:k,...v,ref:j,onKeyDown:A(p,s=>{s.key==="Enter"&&s.preventDefault()}),onClick:A(m,s=>{h(f=>y(f)?!0:!f),w&&d&&(c.current=s.isPropagationStopped(),c.current||s.stopPropagation())})})});K.displayName=H;var X=l.forwardRef((o,p)=>{const{__scopeCheckbox:m,name:v,checked:u,defaultChecked:t,required:k,disabled:C,value:b,onCheckedChange:n,form:a,...h}=o;return e.jsx(ue,{__scopeCheckbox:m,checked:u,defaultChecked:t,disabled:C,required:k,onCheckedChange:n,name:v,form:a,value:b,internal_do_not_use_render:({isFormControl:c})=>e.jsxs(e.Fragment,{children:[e.jsx(K,{...h,ref:p,__scopeCheckbox:m}),c&&e.jsx(J,{__scopeCheckbox:m})]})})});X.displayName=I;var U="CheckboxIndicator",$=l.forwardRef((o,p)=>{const{__scopeCheckbox:m,forceMount:v,...u}=o,t=F(U,m);return e.jsx(se,{present:v||y(t.checked)||t.checked===!0,children:e.jsx(P.span,{"data-state":V(t.checked),"data-disabled":t.disabled?"":void 0,...u,ref:p,style:{pointerEvents:"none",...o.style}})})});$.displayName=U;var G="CheckboxBubbleInput",J=l.forwardRef(({__scopeCheckbox:o,...p},m)=>{const{control:v,hasConsumerStoppedPropagationRef:u,checked:t,defaultChecked:k,required:C,disabled:b,name:n,value:a,form:h,bubbleInput:c,setBubbleInput:d}=F(G,o),w=z(m,d),j=oe(t),i=ne(v);l.useEffect(()=>{const f=c;if(!f)return;const N=window.HTMLInputElement.prototype,E=Object.getOwnPropertyDescriptor(N,"checked").set,x=!u.current;if(j!==t&&E){const r=new Event("click",{bubbles:x});f.indeterminate=y(t),E.call(f,y(t)?!1:t),f.dispatchEvent(r)}},[c,j,t,u]);const s=l.useRef(y(t)?!1:t);return e.jsx(P.input,{type:"checkbox","aria-hidden":!0,defaultChecked:k??s.current,required:C,disabled:b,name:n,value:a,form:h,...p,tabIndex:-1,ref:w,style:{...p.style,...i,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});J.displayName=G;function fe(o){return typeof o=="function"}function y(o){return o==="indeterminate"}function V(o){return y(o)?"indeterminate":o?"checked":"unchecked"}function pe({className:o,...p}){return e.jsx(X,{"data-slot":"checkbox",className:Z("peer border-input data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",o),...p,children:e.jsx($,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(ae,{className:"size-3.5"})})})}function Re({status:o,canResetPassword:p,mode:m,redirect:v,error:u}){const[t,k]=l.useState(!1),[C,b]=l.useState(!1),[n,a]=l.useState(!1),[h,c]=l.useState(!1),{data:d,setData:w,post:j,processing:i,errors:s,reset:f}=W({email:"",password:"",remember:!1,mode:typeof m=="string"?m:void 0,redirect:v??void 0});l.useEffect(()=>{a(i)},[i]),l.useEffect(()=>{const x=sessionStorage.getItem("login_pending_resubmit");if(x)try{const r=JSON.parse(x);console.log("[Login] Found pending resubmit data, auto-submitting...",r),c(!1),w({email:r.email||"",password:r.password||"",remember:r.remember||!1,mode:r.mode,redirect:r.redirect}),setTimeout(()=>{a(!0);const L="/login",g={email:r.email||"",password:r.password||"",remember:r.remember||!1,mode:r.mode,redirect:r.redirect},R=document.querySelector('meta[name="csrf-token"]')?.content;R&&typeof window<"u"&&window.axios&&(window.axios.defaults.headers.common["X-CSRF-TOKEN"]=R),O.post(L,g,{preserveState:!0,preserveScroll:!1,onStart:()=>a(!0),onProgress:()=>a(!0),onFinish:()=>{a(!1),f("password"),c(!1),sessionStorage.removeItem("login_pending_resubmit"),console.log("[Login] Auto-resubmit finished")},onSuccess:()=>{sessionStorage.removeItem("login_pending_resubmit"),c(!1)},onError:()=>{setTimeout(()=>a(!1),150),c(!0),sessionStorage.removeItem("login_pending_resubmit")}}).catch(()=>{c(!0),setTimeout(()=>a(!1),400),sessionStorage.removeItem("login_pending_resubmit")})},300)}catch(r){console.error("[Login] Failed to parse pending resubmit data:",r),sessionStorage.removeItem("login_pending_resubmit")}},[]),l.useEffect(()=>{(s.email||s.password)&&c(!0)},[s.email,s.password]);const N=x=>{w("email",x.target.value)},S=x=>{w("password",x.target.value)};l.useEffect(()=>{const x=document.querySelector('meta[name="csrf-token"]');x&&x.content?(typeof window<"u"&&window.axios&&(window.axios.defaults.headers.common["X-CSRF-TOKEN"]=x.content),b(!0),console.log("[Login] CSRF token loaded from meta tag")):(console.warn("[Login] CSRF meta tag not found, fetching CSRF cookie..."),fetch("/sanctum/csrf-cookie",{method:"HEAD",credentials:"include",cache:"no-store"}).then(()=>{setTimeout(()=>{const r=document.querySelector('meta[name="csrf-token"]');r&&r.content&&(typeof window<"u"&&window.axios&&(window.axios.defaults.headers.common["X-CSRF-TOKEN"]=r.content),b(!0),console.log("[Login] CSRF token updated after cookie fetch"))},100)}).catch(r=>{console.error("[Login] Failed to fetch CSRF cookie:",r)}))},[]);const E=x=>{if(x.preventDefault(),i||n){console.warn("[Login] Form is already submitting, ignoring duplicate submission");return}if(h){console.log("[Login] Previous error detected - refreshing page before resubmit...");const g={email:d.email,password:d.password,remember:d.remember,mode:d.mode,redirect:d.redirect};sessionStorage.setItem("login_pending_resubmit",JSON.stringify(g)),a(!0),setTimeout(()=>{window.location.reload()},100);return}const r=document.querySelector('meta[name="csrf-token"]')?.content;if(!r){console.error("CSRF token not found in meta tag");return}r&&typeof window<"u"&&window.axios&&(window.axios.defaults.headers.common["X-CSRF-TOKEN"]=r),a(!0);const L="/login";console.log("[Login] Form submission started - validating credentials..."),O.post(L,d,{preserveState:!0,preserveScroll:!1,forceFormData:!1,onStart:()=>{a(!0)},onProgress:()=>{a(!0)},onFinish:()=>{a(!1),f("password"),console.log("[Login] Form submission finished")},onSuccess:g=>{console.log("[Login] Success - redirecting...",{url:g.url,component:g.component}),sessionStorage.removeItem("login_pending_resubmit"),c(!1)},onError:g=>{console.error("[Login] Error occurred:",g),setTimeout(()=>a(!1),150),c(!0);const R=g?.message||(typeof g=="string"?g:"")||"",Q=JSON.stringify(g||{});if(/419|expired|PAGE EXPIRED|csrf|token/i.test(R)||/419|expired|csrf|token/i.test(Q)){console.warn("[Login] CSRF token expired, reloading page..."),setTimeout(()=>window.location.reload(),400);return}const T=document.querySelector('meta[name="csrf-token"]')?.content;T&&typeof window<"u"&&window.axios&&(window.axios.defaults.headers.common["X-CSRF-TOKEN"]=T.content)}}).catch(g=>{console.error("[Login] Request failed (network or other):",g),c(!0),setTimeout(()=>a(!1),400)})};return e.jsxs(ce,{title:m==="admin"?"Admin Login":"Log in to your account",description:m==="admin"?"Enter your admin credentials to access the admin dashboard":"Enter your email and password below to log in",children:[e.jsx(Y,{title:m==="admin"?"Admin Login":"Log in"}),u&&e.jsx("div",{className:"mb-4 rounded-lg border border-red-500/30 bg-red-500/10 p-3",children:e.jsx("p",{className:"text-sm text-red-300",children:u})}),e.jsxs("form",{method:"POST",className:"flex flex-col gap-6 relative",onSubmit:E,children:[(i||n)&&e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"flex flex-col items-center gap-4 rounded-xl bg-gray-900/98 px-8 py-6 shadow-2xl border border-amber-500/20",children:[e.jsx(B,{className:"h-10 w-10 animate-spin text-amber-500"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-base font-semibold text-white",children:h?"Refreshing page...":"Validating credentials..."}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:h?"Please wait while we refresh and validate your credentials":"Please wait while we verify your information"})]}),e.jsx("div",{className:"w-48 h-1 bg-gray-700 rounded-full overflow-hidden mt-2",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-amber-500 to-orange-500 animate-pulse",style:{width:"60%"}})})]})}),d.mode&&e.jsx("input",{type:"hidden",name:"mode",value:d.mode}),d.redirect&&e.jsx("input",{type:"hidden",name:"redirect",value:d.redirect}),e.jsxs("div",{className:`grid gap-6 transition-opacity duration-200 ${i||n?"opacity-50 pointer-events-none":"opacity-100"}`,children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{htmlFor:"email",children:"Email address"}),e.jsx(M,{id:"email",type:"email",required:!0,autoFocus:!0,tabIndex:1,autoComplete:"email",value:d.email,onChange:N,placeholder:"email@example.com",disabled:i||n,className:i||n?"opacity-60 cursor-not-allowed":""}),e.jsx(q,{message:s.email}),s.email&&e.jsx("div",{className:"mt-2 rounded-lg border border-red-500/30 bg-red-500/10 p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("svg",{className:"mt-0.5 h-4 w-4 flex-shrink-0 text-red-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-red-300",children:s.email}),s.email.includes("Admin accounts cannot login")&&e.jsxs("p",{className:"mt-1 text-xs text-red-200",children:["Please use the admin login page directly at ",e.jsx("code",{className:"text-xs bg-red-500/20 px-1 py-0.5 rounded",children:"/admin"})]})]})]})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(_,{htmlFor:"password",children:"Password"}),p&&e.jsx(D,{href:route("password.request"),className:"ml-auto text-sm",tabIndex:5,children:"Forgot password?"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(M,{id:"password",type:t?"text":"password",required:!0,tabIndex:2,autoComplete:"current-password",value:d.password,onChange:S,placeholder:"Password",className:`pr-10 ${i||n?"opacity-60 cursor-not-allowed":""}`,disabled:i||n}),e.jsx("button",{type:"button",onClick:()=>k(!t),disabled:i||n,className:`absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 focus:outline-none focus:text-gray-600 transition-colors ${i||n?"opacity-50 cursor-not-allowed":""}`,tabIndex:-1,"aria-label":t?"Hide password":"Show password",children:t?e.jsx(ie,{className:"h-4 w-4"}):e.jsx(de,{className:"h-4 w-4"})})]}),e.jsx(q,{message:s.password}),s.password&&e.jsx("div",{className:"mt-2 rounded-lg border border-red-500/30 bg-red-500/10 p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("svg",{className:"mt-0.5 h-4 w-4 flex-shrink-0 text-red-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),e.jsx("p",{className:"text-sm font-medium text-red-300",children:s.password})]})})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(pe,{id:"remember",name:"remember",checked:d.remember,onClick:()=>w("remember",!d.remember),tabIndex:3,disabled:i||n,className:i||n?"opacity-60 cursor-not-allowed":""}),e.jsx(_,{htmlFor:"remember",className:i||n?"opacity-60 cursor-not-allowed":"",children:"Remember me"})]}),e.jsx(ee,{type:"submit",className:"mt-4 w-full relative min-h-[44px]",tabIndex:4,disabled:i||n,children:i||n?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(B,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Validating credentials..."})]}):"Log in"})]}),m!=="admin"&&e.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:["Don't have an account?"," ",e.jsx(D,{href:route("register"),tabIndex:5,children:"Sign up"})]})]}),o&&e.jsx("div",{className:"mb-4 text-center text-sm font-medium text-green-600",children:o})]})}export{Re as default};
